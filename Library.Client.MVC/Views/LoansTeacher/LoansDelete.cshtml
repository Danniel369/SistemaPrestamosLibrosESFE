@model IEnumerable<Library.DataAccess.Domain.LoansTeacher>
@{
    ViewData["Title"] = "Préstamos Eliminados";
    int[] tops = { 10, 20, 50, 100, 500, 1000, 10000, -1 };
    int topActual = Convert.ToInt32(ViewBag.Top);
}

<style>
    body {
        overflow-x: hidden;
    }

    .spacer {
        margin-right: 20px;
    }

    #contenedor-principal {
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        border: 1px solid #f3f4f6;
    }

        #contenedor-principal:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
            border: 1px solid #e5e7eb;
        }

        #search-button, #selectRedireccion, #contenedor-principal input, #contenedor-principal select {
            transition: all 0.3s ease;
        }

            #search-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            }

    @@media (max-width: 768px) {
        .form-busqueda {
            flex-direction: column !important;
            align-items: stretch !important;
        }

        .spacer {
            margin-right: 0 !important;
            margin-bottom: 10px !important;
        }
    }

    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 15px;
        gap: 5px;
    }

    .page-btn {
        display: inline-block;
        padding: 6px 12px;
        border: 1px solid #d1d5db;
        background-color: #f9fafb;
        color: #374151;
        text-decoration: none;
        border-radius: 5px;
        font-size: 14px;
        transition: all 0.2s ease;
    }

        .page-btn:hover {
            background-color: #e5e7eb;
            color: #111827;
        }

        .page-btn.active {
            background-color: #d1d5db;
            color: #111827;
            font-weight: bold;
            border-color: #9ca3af;
        }

    .fade-page {
        opacity: 0;
        transition: opacity 0.5s ease;
    }

        .fade-page.show {
            opacity: 1;
        }
</style>

<div class="card" id="contenedor-principal">
    <div class="card-body">
        <h1 style="padding:15px; font-family: 'Poppins', sans-serif; font-weight: 600; margin-left: -15px;">Préstamos Generales Eliminados</h1>

        <div class="d-flex flex-wrap form-busqueda mb-3">
            <form asp-action="LoansDeleted" class="d-flex flex-wrap form-busqueda w-100" method="get">
                <div class="spacer">
                    <input type="text" placeholder="Nombre Personal" class="form-control" name="personalName" value="@ViewData["personalName"]" />
                </div>

                <div class="spacer">
                    <select id="selectRedireccion" class="form-control">
                        <option value="" selected>Ir a...</option>
                        <option value="opcion1">Préstamos Activos</option>
                    </select>
                </div>

                <div class="spacer d-flex align-items-center">
                    <label class="control-label me-2 mb-0">Mostrar</label>
                    <select name="pageSize" class="form-control">
                        @foreach (var item in tops)
                        {
                            string strItem = item != -1 ? item.ToString() : "Todos";
                            <!option value="@item" @(item == topActual ? "selected" : "")>@strItem</!option>
                        }
                    </select>
                </div>

                <div class="spacer">
                    <button id="search-button" type="submit" class="btn btn-secondary">
                        <i class="bi bi-search"></i> Buscar
                    </button>
                </div>
                <input type="hidden" name="page" value="1" />
            </form>
        </div>
        <hr />

        <div class="table-responsive fade-page show" id="tableContainer">
            <table id="customers" class="table table-striped table-bordered align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Estado Reservacion</th>
                        <th>Nombre Personal</th>
                        <th>Correo</th>
                        <th>Rol</th>
                        <th>Libro</th>
                        <th>ESTADO</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>@item.LOANSTEACHER_ID</td>
                                <td>@(item.LoanTypes?.TYPES_NAME ?? "N/A")</td>
                                <td>@(item.ReservationStatus?.STATUS_NAME ?? "N/A")</td>
                                <td>@item.PERSONALNAME</td>
                                <td>@item.EMAIL</td>
                                <td>@item.ROL</td>
                                <td>@(item.Books?.TITLE ?? "Sin título")</td>
                                <td>ELIMINADO</td>
                                <td class="text-center">
                                    <a href="@Url.Action("Edit", new { id = item.LOANSTEACHER_ID })" class="btn btn-sm text-white" style="background: #1D4ED8">
                                        <i class="bi bi-eye"></i> Editar
                                    </a>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="9" class="text-center py-4">No se encontraron préstamos eliminados con esos criterios.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (ViewBag.TotalPaginas > 1)
        {
            <nav class="pagination-container">
                @if (ViewBag.PaginaActual > 1)
                {
                    <a class="page-btn" asp-action="LoansDeleted" asp-route-page="@(ViewBag.PaginaActual - 1)" asp-route-pageSize="@ViewBag.Top" asp-route-personalName="@ViewData["personalName"]">Anterior</a>
                }
                @for (int i = 1; i <= ViewBag.TotalPaginas; i++)
                {
                    <a class="page-btn @(i == ViewBag.PaginaActual ? "active" : "")" asp-action="LoansDeleted" asp-route-page="@i" asp-route-pageSize="@ViewBag.Top" asp-route-personalName="@ViewData["personalName"]">@i</a>
                }
                @if (ViewBag.PaginaActual < ViewBag.TotalPaginas)
                {
                    <a class="page-btn" asp-action="LoansDeleted" asp-route-page="@(ViewBag.PaginaActual + 1)" asp-route-pageSize="@ViewBag.Top" asp-route-personalName="@ViewData["personalName"]">Siguiente</a>
                }
            </nav>
        }
    </div>
</div>

<script>
    document.getElementById('selectRedireccion').addEventListener('change', function() {
        const value = this.value;
        if (value === 'opcion1') window.location.href = '@Url.Action("Index", "LoansTeacher")';
        else if (value === 'opcion2') window.location.href = '@Url.Action("LoansDeleted", "LoansTeacher")';
    });

    document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("tableContainer");
        setTimeout(() => container.classList.add("show"), 50);

        document.querySelectorAll(".page-btn").forEach(link => {
            link.addEventListener("click", function (e) {
                e.preventDefault();
                container.classList.remove("show");
                setTimeout(() => { window.location.href = this.href; }, 400);
            });
        });
    });
</script>